<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mycompany.javajavajo.dao.QnaDao">
	
	<insert id="insertBoard" parameterType="Qna">
	<!-- dto의 qnano에 시퀀스 번호를 qnano에 넣어줌 -->
	<selectKey keyProperty="qnano" order="BEFORE" resultType="int"> 
			select qna_seq.nextval from dual 
	</selectKey>
		insert into qna (qnano, memno, qnacontent, qnatitle, qnadate, qnahitcnt , qnalock, qnaattachoname, qnaattachtype, qnaattachdata)
		values(#{qnano}, #{memno}, #{qnacontent}, #{qnatitle}, sysdate, 0, #{qnalock}, #{qnaattachoname}, #{qnaattachtype}, #{qnaattachdata})
	</insert>
	

	<select id="selectByQnano" parameterType="int" resultType="Qna">
		select *
		from (
			select qnano, memno, qnatitle, qnacontent, qnadate, qnahitcnt, qnalock,
			lag(qnatitle,1,-1) over(order by qnano) as pretitle,  lag(qnano,1,-1) over(order by qnano) as preno,
			lag(memno,1,-1) over(order by qnano) as prememno, 	lag(qnalock,1,-1) over(order by qnano) as prelock,
			lead(qnatitle,1,-1) over(order by qnano) as nexttitle,lead(qnano,1,-1) over(order by qnano) as nextno,
			lead(memno,1,-1) over(order by qnano) as nextmemno,	lead(qnalock,1,-1) over(order by qnano) as nextlock
			from qna
		)
		where qnano = #{qnano}
	</select>

	<select id="selectQnaListByKeyword" parameterType="String" resultType="Qna">
		select *
		from qna
		<if test='#{keyword} != null or #{keyword}.equals("")'>
			where qnatitle like '%' || #{keyword} || '%'
			or qnacontent like '%' || #{keyword} || '%'
			order by qnano desc
		</if>
	</select>

	<update id="updatehitcnt" parameterType="int">
		update qna set
			qnahitcnt = qnahitcnt + 1
			where qnano = #{qnano}
	</update>

	<update id="updateQna" parameterType="Qna">
		update qna set
			qnatitle=#{qnatitle},
			qnacontent=#{qnacontent}
			where qnano = #{qnano}
	</update>

	<delete id="deleteQna" parameterType="int">
		delete from qna where qnano = #{qnano}
	</delete>

	<select id="count" resultType="int">
		select count(*) from qna
	</select>
	
	<select id="selectByPage" parameterType="Pager" resultType="Qna">
	<![CDATA[
		select rnum, qnano, qnatitle, qnacontent, memno, qnadate, qnahitcnt, qnalock
		from (
		    select rownum as rnum, qnano, qnatitle, qnacontent, memno, qnadate, qnahitcnt, qnalock
		    from (
		        select qnano, qnatitle, qnacontent, memno, qnadate, qnahitcnt, qnalock
		        from qna 
		        order by qnano desc
		    )
		    where rownum <= #{endRowNo}
		)
		where rnum >= #{startRowNo}
		]]>
	</select>

</mapper>




