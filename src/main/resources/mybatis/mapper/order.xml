<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mycompany.javajavajo.dao.OrderDao">

	<insert id="insert" parameterType="Order">
		<selectKey keyProperty="ordno" order="BEFORE"
			resultType="int">
			select order_seq.nextval from dual
		</selectKey>
		insert into ord (ordno, memno, ordstts, orddate, ordprice, discprice,
		finprice)
		values
		(#{ordno}, #{memno}, #{ordstts}, sysdate, #{ordprice}, #{discprice},
		#{finprice})
	</insert>

	<select id="selectOrderByMemno" parameterType="int"
		resultType="Order">
		select * from ord where memno = #{memno} order by orddate
		desc
	</select>

	<select id="selectOrderByOrdno" parameterType="int"
		resultType="Order">
		select ordno, memno, ord.ordstts, ordstts.ordsttschar,
		orddate, ordprice, discprice, finprice, rqst
		from ord, ordstts
		where ord.ordstts = ordstts.ordsttsno and ord.ordno = #{ordno}
	</select>

	<update id="updateOrdStts">
		update ord
		set ordstts = #{ordstts}
		where ordno =
		#{ordno}
	</update>

	<select id="getTotalUncomOrders">
		select count(*) from ord where ordstts != 4 and
		ordstts != 5
	</select>

	<select id="selectUncomOrderByPager" parameterType="Pager"
		resultType="Order">
		<![CDATA[
		select rnum, ordno, memno, ordstts, ordsttschar, orddate, ordprice, discprice, finprice
		from (
		select rownum as rnum, ordno, memno, ordstts, ordsttschar, orddate, ordprice, discprice, finprice
		from (
		select ordno, memno, ord.ordstts, ordstts.ordsttschar, orddate, ordprice, discprice, finprice
		from ord, ordstts
		where ordstts != 4 and ordstts != 5 and ord.ordstts = ordstts.ordsttsno
		order by ordno desc
		)
		where rownum <= #{endRowNo}
		)
		where rnum >= #{startRowNo}
		]]>
	</select>
	
</mapper>	